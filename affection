--// Intro GUI & Sound with spinning image
local player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")
local gui = Instance.new("ScreenGui")
gui.Parent = game:GetService("CoreGui") -- Hide from detection

local imageLabel = Instance.new("ImageLabel")
imageLabel.Parent = gui
imageLabel.Size = UDim2.new(0, 150, 0, 150)
imageLabel.Position = UDim2.new(0.5, -75, 0.5, -75)
imageLabel.Image = "rbxassetid://106379881817322" -- Replace with actual asset ID
imageLabel.BackgroundTransparency = 1
imageLabel.ScaleType = Enum.ScaleType.Fit
imageLabel.Rotation = 0

local sound = Instance.new("Sound")
sound.Parent = gui
sound.SoundId = "rbxassetid://130809871712701" -- Replace with actual asset ID
sound:Play()

local rotation = 0
local spinConnection

-- Spin the image 180 degrees per second
spinConnection = RunService.RenderStepped:Connect(function(deltaTime)
    rotation = (rotation + 180 * deltaTime) % 360
    imageLabel.Rotation = rotation
end)

task.wait(3)

spinConnection:Disconnect()
imageLabel:Destroy()
sound:Stop()
sound:Destroy()

--// affection.cc custom version (Prediction + Anti-Ground + Auto Unlock + AirShoot)
print("Affection.cc | Custom Version Loaded")

--// SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

--// CONFIG
local Config = {
    Prediction = 0.125,                           -- Adjust for ping
    AntiGround = true,                            -- ✅ Toggle Anti-Ground ON/OFF
    AntiGroundOffset = Vector3.new(0, 2.5, 0),   -- Height adjustment if AntiGround = true
    ToggleKey = Enum.KeyCode.Q,                  -- Keybind for toggle
    HitPart = "HumanoidRootPart",                -- Lock target part
    AirShoot = true                              -- Auto shoot in air
}

--// Notification
local function showNotification(text)
    game.StarterGui:SetCore("SendNotification", {
        Title = "Affection.cc",
        Text = text,
        Duration = 1.5
    })
end
showNotification("Affection.cc Loaded")

--// Variables
local camlockEnabled = false
local lockedPlayer = nil

--// GUI (with your Hellgrave style but Affection name)
local function CreateAffectionGUI()
    local affectionGui = Instance.new("ScreenGui")
    affectionGui.ResetOnSpawn = false
    affectionGui.Name = "AffectionGUI"
    affectionGui.Parent = game.CoreGui

    local affectionFrame = Instance.new("Frame")
    affectionFrame.Size = UDim2.new(0, 180, 0, 70)
    affectionFrame.Position = UDim2.new(0.4, 0, 0.4, 0)
    affectionFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    affectionFrame.BackgroundTransparency = 0.3
    affectionFrame.BorderSizePixel = 0
    affectionFrame.Parent = affectionGui

    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 12)
    uiCorner.Parent = affectionFrame

    local affectionLogo = Instance.new("ImageButton")
    affectionLogo.Size = UDim2.new(0, 140, 0, 50)
    affectionLogo.Position = UDim2.new(0.1, 0, 0.15, 0)
    affectionLogo.BackgroundTransparency = 1
    affectionLogo.Image = "rbxassetid://88724352247002" -- Replace with your logo asset
    affectionLogo.Parent = affectionFrame

    local logoCorner = Instance.new("UICorner")
    logoCorner.CornerRadius = UDim.new(0.2, 0)
    logoCorner.Parent = affectionLogo

    -- Button Click
    affectionLogo.MouseButton1Click:Connect(function()
        toggleCamlock()
    end)

    -- Dragging
    local dragging, dragStart, startPos
    local function updateInput(input)
        local delta = input.Position - dragStart
        affectionFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    affectionFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = affectionFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            updateInput(input)
        end
    end)
end

--// Create GUI
CreateAffectionGUI()

--// Get Closest Player
local function getClosestPlayer()
    local closest, shortest = nil, math.huge
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild(Config.HitPart) then
            local pos, onScreen = Camera:WorldToViewportPoint(p.Character[Config.HitPart].Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - screenCenter).Magnitude
                if dist < 150 and dist < shortest then
                    shortest = dist
                    closest = p
                end
            end
        end
    end
    return closest
end

--// Toggle Camlock
function toggleCamlock()
    if not camlockEnabled then
        local target = getClosestPlayer()
        if target then
            camlockEnabled = true
            lockedPlayer = target
            showNotification("Locked onto " .. target.Name)
        else
            showNotification("No player found")
        end
    else
        camlockEnabled = false
        lockedPlayer = nil
        showNotification("Lock Disabled")
    end
end

--// Keybind
UserInputService.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == Config.ToggleKey then
        toggleCamlock()
    end
end)

--// Auto-Unlock on Player Leave
Players.PlayerRemoving:Connect(function(player)
    if player == lockedPlayer then
        camlockEnabled = false
        lockedPlayer = nil
        showNotification("Target left, lock disabled")
    end
end)

--// Unlock if LocalPlayer Dies
RunService.Heartbeat:Connect(function()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        if LocalPlayer.Character.Humanoid.Health <= 3 and camlockEnabled then
            camlockEnabled = false
            lockedPlayer = nil
            showNotification("You died, lock disabled")
        end
    end
end)

--// RenderStepped (Main Lock Logic)
RunService.RenderStepped:Connect(function()
    if camlockEnabled and lockedPlayer and lockedPlayer.Character then
        local humanoid = lockedPlayer.Character:FindFirstChildOfClass("Humanoid")
        local hitPart = lockedPlayer.Character:FindFirstChild(Config.HitPart)
        local rootVel = hitPart and hitPart.Velocity

        if humanoid and humanoid.Health > 5 and hitPart then
            -- Prediction
            local predictedPos = hitPart.Position + (rootVel * Config.Prediction)

            -- ✅ Anti-Ground only if enabled
            if Config.AntiGround and humanoid.FloorMaterial ~= Enum.Material.Air then
                predictedPos = predictedPos + Config.AntiGroundOffset
            end

            -- Camera Lock
            local camPos = Camera.CFrame.Position
            local dir = (predictedPos - camPos).Unit
            local newPos = camPos + dir * 0.12
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(newPos, predictedPos), 0.9)

            -- Air Shoot
            if Config.AirShoot and humanoid.FloorMaterial == Enum.Material.Air then
                local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
                if tool then tool:Activate() end
            end
        else
            camlockEnabled = false
            lockedPlayer = nil
            showNotification("Target died, lock disabled")
        end
    end
end)
