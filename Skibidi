-- Set the global key for toggling camlock
getgenv().Key = "q"

-- Services and initial variables
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local CamlockState = false
local Locked = false
local AutoAirActive = false -- State for Auto Air activation

-- Prediction values with ping-based adjustment
local basePrediction = 0.1412 -- Adjust this base prediction if needed
local Prediction = basePrediction

-- Continuously adjust prediction based on ping
RunService.Heartbeat:Connect(function()
    local ping = tonumber(Stats.Network.ServerStatsItem["Data Ping"]:GetValueString()) or 0
    Prediction = basePrediction + (ping / 1000) * 0.2 -- Scales prediction based on ping
end)

-- Function to find the nearest enemy
function FindNearestEnemy()
    local ClosestDistance, ClosestPlayer = math.huge, nil
    local CenterPosition = Vector2.new(game:GetService("GuiService"):GetScreenResolution().X / 2, game:GetService("GuiService"):GetScreenResolution().Y / 2)

    for _, Player in ipairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character then
            local RootPart = Player.Character:FindFirstChild("HumanoidRootPart")
            local Humanoid = Player.Character:FindFirstChildOfClass("Humanoid")

            if RootPart and Humanoid and Humanoid.Health > 0 then
                local Position, IsVisibleOnViewport = game:GetService("Workspace").CurrentCamera:WorldToViewportPoint(RootPart.Position)

                if IsVisibleOnViewport then
                    local Distance = (CenterPosition - Vector2.new(Position.X, Position.Y)).Magnitude
                    if Distance < ClosestDistance then
                        ClosestPlayer = RootPart
                        ClosestDistance = Distance
                    end
                end
            end
        end
    end
    return ClosestPlayer
end

local enemy = nil

-- Function to check anti-cheat movement
local function CheckAnti(Plr)
    local velocity = Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart") and Plr.Character.HumanoidRootPart.Velocity
    if velocity then
        if velocity.Y < -70 then
            return true
        elseif velocity.X > 450 or velocity.X < -35 then
            return true
        elseif velocity.Y > 60 then
            return true
        elseif velocity.Z > 35 or velocity.Z < -35 then
            return true
        end
    end
    return false
end

-- Main Camlock functionality with Auto Unlock and Auto Tool
RunService.Heartbeat:Connect(function()
    if CamlockState and enemy and enemy.Parent then
        local targetPart = enemy.Parent:FindFirstChild("HumanoidRootPart")
        local targetHumanoid = enemy.Parent:FindFirstChildOfClass("Humanoid")
        local myHumanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")

        -- Auto Unlock if enemy or local player dies
        if (targetHumanoid and targetHumanoid.Health <= 0) or (myHumanoid and myHumanoid.Health <= 0) then
            CamlockState = false
            enemy = nil
            return
        end

        -- If AntiCheat detects suspicious movement, unlock
        if CheckAnti(enemy.Parent) then
            CamlockState = false
            enemy = nil
            return
        end

        if targetPart then
            local camera = workspace.CurrentCamera
            camera.CFrame = CFrame.new(camera.CFrame.p, targetPart.Position + targetPart.Velocity * Prediction)

            -- Anti-ground: Reduce the enemy's freefall speed if they're falling
            if targetHumanoid and targetHumanoid:GetState() == Enum.HumanoidStateType.Freefall then
                targetPart.Velocity = Vector3.new(targetPart.Velocity.X, targetPart.Velocity.Y * 0.5, targetPart.Velocity.Z)
            end
        end

        -- Auto Tool Activation when LocalPlayer is in the air
        if AutoAirActive and myHumanoid and myHumanoid.FloorMaterial == Enum.Material.Air then
            local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
            if tool then
                tool:Activate()
            end
        end
    end
end)

-- Toggle camlock on key press
Mouse.KeyDown:Connect(function(k)
    if k == getgenv().Key then
        Locked = not Locked
        if Locked then
            enemy = FindNearestEnemy()
            CamlockState = true
        else
            enemy = nil
            CamlockState = false
        end
    end
end)

-- GUI creation
local HELLBOUND = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local TextButton = Instance.new("TextButton")
local AutoAirButton = Instance.new("TextButton")

HELLBOUND.Name = "HELLBOUND"
HELLBOUND.Parent = game.CoreGui

Frame.Parent = HELLBOUND
Frame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Frame.Size = UDim2.new(0, 200, 0, 60)
Frame.Position = UDim2.new(0.5, -100, 0.1, 0)
Frame.Active = true
Frame.Draggable = true

UICorner.Parent = Frame

-- Camlock Toggle Button
TextButton.Parent = Frame
TextButton.Position = UDim2.new(0.1, 0, 0.3, 0)
TextButton.Size = UDim2.new(0.8, 0, 0.3, 0)
TextButton.Font = Enum.Font.Fantasy
TextButton.Text = "HELLBOUND OFF"
TextButton.TextColor3 = Color3.fromRGB(255, 0, 0)
TextButton.TextScaled = true

-- Toggle Camlock State
TextButton.MouseButton1Click:Connect(function()
    CamlockState = not CamlockState
    TextButton.Text = CamlockState and "HELLBOUND ON" or "HELLBOUND OFF"
    TextButton.TextColor3 = CamlockState and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)

    if CamlockState then
        enemy = FindNearestEnemy()
    else
        enemy = nil
    end
end)

-- Auto Air Toggle Button
AutoAirButton.Parent = Frame
AutoAirButton.Position = UDim2.new(0.1, 0, 0.7, 0)
AutoAirButton.Size = UDim2.new(0.8, 0, 0.3, 0)
AutoAirButton.Font = Enum.Font.Fantasy
AutoAirButton.Text = "Auto Air OFF"
AutoAirButton.TextColor3 = Color3.fromRGB(255, 0, 0)
AutoAirButton.TextScaled = true

-- Toggle Auto Air
AutoAirButton.MouseButton1Click:Connect(function()
    AutoAirActive = not AutoAirActive
    AutoAirButton.Text = AutoAirActive and "Auto Air ON" or "Auto Air OFF"
    AutoAirButton.TextColor3 = AutoAirActive and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
end)
