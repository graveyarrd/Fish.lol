-- Set the global key for toggling camlock
getgenv().Key = "q"

-- Services and initial variables
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local CamlockState = false
local Locked = false
local AutoAirActive = false -- State for Auto Air activation

-- Prediction values with ping-based adjustment
local basePrediction = 0.1412
local Prediction = basePrediction

-- Adjust prediction based on ping
RunService.Heartbeat:Connect(function()
    local ping = tonumber(Stats.Network.ServerStatsItem["Data Ping"]:GetValueString()) or 0
    Prediction = basePrediction + (ping / 1000) * 0.2
end)

-- Find the nearest enemy
function FindNearestEnemy()
    local ClosestDistance, ClosestPlayer = math.huge, nil
    local CenterPosition = Vector2.new(workspace.CurrentCamera.ViewportSize.X / 2, workspace.CurrentCamera.ViewportSize.Y / 2)

    for _, Player in ipairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character then
            local RootPart = Player.Character:FindFirstChild("HumanoidRootPart")
            local Humanoid = Player.Character:FindFirstChildOfClass("Humanoid")

            if RootPart and Humanoid and Humanoid.Health > 0 then
                local Position, Visible = workspace.CurrentCamera:WorldToViewportPoint(RootPart.Position)
                if Visible then
                    local Distance = (CenterPosition - Vector2.new(Position.X, Position.Y)).Magnitude
                    if Distance < ClosestDistance then
                        ClosestPlayer = RootPart
                        ClosestDistance = Distance
                    end
                end
            end
        end
    end
    return ClosestPlayer
end

local enemy = nil

-- Anti-cheat check
local function CheckAnti(Plr)
    local velocity = Plr.Character and Plr.Character:FindFirstChild("HumanoidRootPart") and Plr.Character.HumanoidRootPart.Velocity
    if velocity then
        if velocity.Y < -70 or velocity.Y > 60 or velocity.X > 450 or velocity.Z > 35 or velocity.X < -35 or velocity.Z < -35 then
            return true
        end
    end
    return false
end

-- Main loop: Lock camera + Auto Unlock + Auto Tool
RunService.Heartbeat:Connect(function()
    if CamlockState and enemy and enemy.Parent then
        local targetPart = enemy.Parent:FindFirstChild("HumanoidRootPart")
        local targetHumanoid = enemy.Parent:FindFirstChildOfClass("Humanoid")
        local myHumanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")

        -- Auto Unlock if target or you die
        if (targetHumanoid and targetHumanoid.Health <= 0) or (myHumanoid and myHumanoid.Health <= 0) then
            CamlockState, Locked, enemy = false, false, nil
            return
        end

        -- Anti-cheat detection
        if CheckAnti(enemy.Parent) then
            CamlockState, Locked, enemy = false, false, nil
            return
        end

        -- Camera Lock
        if targetPart then
            local camera = workspace.CurrentCamera
            camera.CFrame = CFrame.new(camera.CFrame.Position, targetPart.Position + targetPart.Velocity * Prediction)

            -- Anti-ground adjustment
            if targetHumanoid and targetHumanoid:GetState() == Enum.HumanoidStateType.Freefall then
                targetPart.Velocity = Vector3.new(targetPart.Velocity.X, targetPart.Velocity.Y * 0.5, targetPart.Velocity.Z)
            end
        end

        -- Auto Tool when in air
        if AutoAirActive and myHumanoid and myHumanoid.FloorMaterial == Enum.Material.Air then
            local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
            if tool then tool:Activate() end
        end
    end
end)

-- Toggle camlock with key
Mouse.KeyDown:Connect(function(k)
    if k == getgenv().Key then
        Locked = not Locked
        if Locked then
            enemy = FindNearestEnemy()
            CamlockState = enemy ~= nil
        else
            enemy = nil
            CamlockState = false
        end
    end
end)

-- GUI
local HELLBOUND = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local CamButton = Instance.new("TextButton")
local AutoAirButton = Instance.new("TextButton")

HELLBOUND.Name = "HELLBOUND"
HELLBOUND.Parent = game.CoreGui

Frame.Parent = HELLBOUND
Frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Frame.Size = UDim2.new(0, 200, 0, 80)
Frame.Position = UDim2.new(0.5, -100, 0.1, 0)
Frame.Active = true
Frame.Draggable = true
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = Frame

-- Camlock Button
CamButton.Parent = Frame
CamButton.Position = UDim2.new(0.05, 0, 0.15, 0)
CamButton.Size = UDim2.new(0.9, 0, 0.35, 0)
CamButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
CamButton.Font = Enum.Font.GothamBold
CamButton.Text = "HELLBOUND OFF"
CamButton.TextColor3 = Color3.fromRGB(255, 0, 0)
CamButton.TextScaled = true
UICorner:Clone().Parent = CamButton

CamButton.MouseButton1Click:Connect(function()
    if not CamlockState then
        enemy = FindNearestEnemy()
        CamlockState = enemy ~= nil
        Locked = CamlockState
    else
        CamlockState, Locked, enemy = false, false, nil
    end
    CamButton.Text = CamlockState and "HELLBOUND ON" or "HELLBOUND OFF"
    CamButton.TextColor3 = CamlockState and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
end)

-- Auto Air Button
AutoAirButton.Parent = Frame
AutoAirButton.Position = UDim2.new(0.05, 0, 0.6, 0)
AutoAirButton.Size = UDim2.new(0.9, 0, 0.35, 0)
AutoAirButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
AutoAirButton.Font = Enum.Font.GothamBold
AutoAirButton.Text = "Auto Air OFF"
AutoAirButton.TextColor3 = Color3.fromRGB(255, 0, 0)
AutoAirButton.TextScaled = true
UICorner:Clone().Parent = AutoAirButton

AutoAirButton.MouseButton1Click:Connect(function()
    AutoAirActive = not AutoAirActive
    AutoAirButton.Text = AutoAirActive and "Auto Air ON" or "Auto Air OFF"
    AutoAirButton.TextColor3 = AutoAirActive and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
end)
